!function(){"use strict";customElements.get("product-form")||customElements.define("product-form",class extends HTMLElement{constructor(){var t,e,i;super(),i=t=>{const e=t?"add":"remove";this.submitButton&&(this.submitButton.toggleAttribute("aria-busy",t),this.submitButton.disabled=t),this.form.closest(".product-form").classList[e]("adding")},(e="toggleSpinner")in(t=this)?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,this.selectors={form:"form",inputId:"[name=id]",submitButton:'[name="add"]',errorWrapper:".prod__form-error",customFields:["[data-product-custom-field]"],dynamicCheckout:".prod__dynamic_checkout"},this.domNodes=queryDomNodes(this.selectors,this),this.form=this.domNodes.form,this.submitButton=this.domNodes.submitButton,this.domNodes.inputId.disabled=!1,this.notificationType=this.dataset.notificationType,this.customFields=document.querySelectorAll(this.selectors.customFields),this.domNodes.dynamicCheckout&&(this.enable_dynamic_checkout=!0),this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.domNodes.dynamicCheckout&&this.customFields&&this.domNodes.dynamicCheckout.addEventListener("click",t=>{validateForm(this.form.closest(".main-product__blocks")).length>0&&(t.stopPropagation(),window.ConceptSGMTheme.Notification.show({target:this.domNodes.errorWrapper,method:"appendChild",type:"warning",message:window.ConceptSGMStrings.requiredField,delay:100}))},!0)}async onSubmitHandler(t){t.preventDefault(),this.toggleSpinner(!0);const e=validateForm(this.form.closest(".main-product__blocks"));if(e?.length>0)return this.toggleSpinner(!1),window.ConceptSGMTheme.Notification.show({target:this?.domNodes?.errorWrapper,method:"appendChild",type:"warning",message:window.ConceptSGMStrings.requiredField});const i=new FormData(this.form),o=parseInt(i.get("id"),10),s=parseInt(i.get("quantity"))||1,n=this.form.querySelector('[name="quantity"]'),a=parseInt(n?.max)||1/0;let r=!1,d=0;try{const t=await fetch("/cart.js").then(t=>t.json());d=t.items?.find(t=>t.variant_id===o)?.quantity||0}catch(t){d=0}const c=Math.max(a-d,0);if(c<=0)return this.toggleSpinner(!1),window.ConceptSGMTheme.Notification.show({target:this?.domNodes?.errorWrapper,method:"appendChild",type:"warning",message:window.ConceptSGMStrings.cartLimit||"Cantitatea maxima pentru acest produs este deja in cos."});s>=c&&(s>c&&i.set("quantity",c),n&&(r=!0));const m={method:"POST",headers:{Accept:"application/javascript","X-Requested-With":"XMLHttpRequest"},body:i},{ConceptSGMSettings:p,ConceptSGMStrings:h}=window;p.use_ajax_atc?fetch(`${p.routes.cart_add_url}`,m).then(async t=>{let e;try{const i=t.headers.get("content-type");if(i&&i.includes("application/json"))e=await t.json();else{e={message:await t.text()}}}catch(t){e={}}return{statusCode:t.status,body:e}}).then(({statusCode:t,body:e})=>{if(t>=400||e.status){let i=e.description||e.message||e.errors||window.ConceptSGMStrings.cartError;return 429===t&&(i="Ati trimis prea multe cereri. Va rugam sa incercati din nou mai tarziu."),window.ConceptSGMTheme.Notification.show({target:"toast"===this.notificationType?document.body:this.domNodes.errorWrapper,method:"appendChild",type:"warning",message:i,last:3e3,sticky:"toast"===this.notificationType})}p.enable_cart_drawer||window.ConceptSGMTheme.Notification.show({target:this.domNodes.errorWrapper,method:"appendChild",type:"success",message:window.ConceptSGMStrings.itemAdded,last:3e3,sticky:"toast"===this.notificationType}),window.ConceptSGMEvents.emit("ON_ITEM_ADDED",e),window.Shopify.onItemAdded(e),r&&n&&"function"==typeof applyCappedQtyState&&applyCappedQtyState(n)}).catch(()=>{}).finally(()=>{this.toggleSpinner(!1)}):this.form.submit()}})}();